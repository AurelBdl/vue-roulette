(function(m,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(m=typeof globalThis<"u"?globalThis:m||self,n(m.VueRoulette={},m.Vue))})(this,(function(m,n){"use strict";const E=["width","height","aria-label"],H="#27ae60",G="#c0392b",U="#2c3e50",R=n.defineComponent({__name:"VueRoulette",props:{items:{type:Array,required:!0},size:{type:Number,default:400},spinDuration:{type:Number,default:4e3},easingFunction:{type:Function,default:h=>1-Math.pow(1-h,4)},useColor:{type:Boolean,default:!1},initialVelocity:{type:Number,default:2e3},initialAngle:{type:Number,default:0},enableTickSound:{type:Boolean,default:!1},pointerOptions:{type:Object,default:()=>({})},pointerPosition:{type:String,default:"top"},centerHoleRatio:{type:Number,default:.28},spinOnClick:{type:Boolean,default:!1},tickSoundVolume:{type:Number,default:.15},borderWidth:{type:Number,default:4},borderColor:{type:String,default:"#ffffff"}},emits:["spin-start","spin-end","select","update:angle"],setup(h,{expose:J,emit:K}){const w=["#f39c12","#8e44ad","#16a085","#d35400"],a=h,M=K,V=n.ref(null),s=n.ref(a.initialAngle),b=n.ref(!1),A=n.ref(null),i=n.ref({startAngle:a.initialAngle,endAngle:a.initialAngle,duration:a.spinDuration,startTime:0}),T=n.ref(null),y=n.ref(null),k=n.ref(null),x=n.ref(!1),N=n.computed(()=>({visible:!0,color:"#ffffff",width:26,length:38,...a.pointerOptions??{}})),L=n.computed(()=>N.value.visible!==!1),Q=n.computed(()=>{const{width:t,length:e,color:r}=N.value,l={"--pointer-width":`${t}px`,"--pointer-length":`${e}px`,"--pointer-color":r??"#ffffff"},o=`${-(e/2)}px`;switch(a.pointerPosition){case"bottom":return{...l,bottom:o,left:"50%",transform:"translate(-50%, 0)"};case"left":return{...l,left:o,top:"50%",transform:"translate(0, -50%)"};case"right":return{...l,right:o,top:"50%",transform:"translate(0, -50%)"};case"top":default:return{...l,top:o,left:"50%",transform:"translate(-50%, 0)"}}}),u=n.computed(()=>{const t=!a.useColor&&a.items.length%2===1;return a.items.map((e,r)=>{if(a.useColor){const p=w.length?r%w.length:0,c=w[p]??"#ffffff",g=e.color??c;return{label:e.label,value:e.value,color:g}}if(t&&r===0)return{label:e.label,value:e.value,color:H};const o=(t?r-1:r)%2===0?G:U;return{label:e.label,value:e.value,color:o}})}),F=n.computed(()=>u.value.length?360/u.value.length:0),S=t=>{const e=t%360;return e>=0?e:e+360},X=()=>{switch(a.pointerPosition){case"right":return-90;case"bottom":return 180;case"left":return 90;case"top":default:return 0}},v=t=>{if(!u.value.length)return null;const e=X(),r=t+e,l=S(r),o=F.value,p=o/2,g=(360-(l-p+360)%360)%360;let d=Math.floor(g/o);return d>=u.value.length&&(d=u.value.length-1),d},B=()=>{const t=v(s.value);return t===null?null:u.value[t]??null},Y=()=>{if(!a.enableTickSound||typeof window>"u")return;k.value||(k.value=new AudioContext);const t=k.value;if(!t)return;t.state==="suspended"&&t.resume();const e=t.createOscillator(),r=t.createGain(),l=Math.max(0,Math.min(1,a.tickSoundVolume));e.frequency.value=1200,r.gain.value=l,e.connect(r),r.connect(t.destination);const o=t.currentTime;r.gain.setValueAtTime(l,o),r.gain.exponentialRampToValueAtTime(1e-4,o+.02),e.start(o),e.stop(o+.02)},Z=()=>{const t=v(s.value);t!==null&&y.value!==t&&(y.value=t,Y())},I=()=>{M("update:angle",S(s.value))},_=t=>{let e=t.replace("#","");e.length===3&&(e=e.split("").map(c=>c+c).join(""));const r=parseInt(e.substring(0,2),16),l=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16);return(.299*r+.587*l+.114*o)/255>.5?"#000000":"#ffffff"},f=()=>{const t=V.value;if(!t)return;const e=t.getContext("2d");if(!e)return;const r=a.size,l=r/2,o=l*a.centerHoleRatio;e.clearRect(0,0,r,r),e.save(),e.translate(l,l);const p=u.value.length,c=a.borderWidth??4;if(!p){const C=l-c/2;e.beginPath(),e.arc(0,0,C,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=c,e.stroke(),e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=c,e.stroke(),e.restore();return}const g=2*Math.PI/p,d=s.value*Math.PI/180,re=-Math.PI/2-g/2,z=l-c/2;u.value.forEach((C,ie)=>{const O=d+ie*g+re,$=O+g;e.beginPath(),e.moveTo(0,0),e.fillStyle=C.color,e.arc(0,0,z,O,$),e.closePath(),e.fill(),e.save(),e.fillStyle=_(C.color),e.rotate((O+$)/2),e.textAlign="right",e.font=`${Math.max(14,l*.08)}px sans-serif`,e.fillText(C.label,z-20,6),e.restore()}),c>0&&(e.beginPath(),e.arc(0,0,z,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=c,e.stroke()),e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.fill(),e.restore(),c>0&&(e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=c,e.stroke()),e.restore()},P=()=>{A.value!==null&&(cancelAnimationFrame(A.value),A.value=null)},ee=()=>{P(),A.value=requestAnimationFrame(W)},W=t=>{i.value.startTime||(i.value.startTime=t);const e=t-i.value.startTime,r=i.value.duration||1,l=Math.min(e/r,1),o=a.easingFunction(l);s.value=i.value.startAngle+(i.value.endAngle-i.value.startAngle)*o,I(),Z(),f(),l<1?A.value=requestAnimationFrame(W):te()},te=()=>{P(),b.value=!1,x.value=!1,I(),f(),M("spin-end");const t=B();T.value=t,t&&M("select",t)},ne=()=>{const t=Math.floor(a.initialVelocity*a.spinDuration/36e4);return Math.max(3,t)+Math.floor(Math.random()*3)},D=()=>{if(u.value.length<=1)return .5;const t=.04;return t+Math.random()*(1-t*2)},j=(t,e,r=.5)=>{if(!u.value.length)return s.value;const l=F.value,o=S(s.value),p=Math.min(Math.max(r,.01),.99),c=l/2;let d=(360-(t+p)*l+c)%360-o;return d<=0&&(d+=360),d+=e*360,s.value+d},q=()=>{if(!u.value.length||b.value)return;x.value=!1;const t=Math.floor(Math.random()*u.value.length),e=u.value[t];e&&(T.value=e,i.value.startAngle=s.value,i.value.endAngle=j(t,ne(),D()),i.value.duration=a.spinDuration,i.value.startTime=0,b.value=!0,M("spin-start"),ee())},ae=()=>{if(!b.value||x.value)return;x.value=!0;const t=v(s.value);if(t===null)return;const e=u.value[t];e&&(T.value=e,i.value.startAngle=s.value,i.value.endAngle=j(t,1,D()),i.value.duration=Math.min(a.spinDuration/2,1e3),i.value.startTime=0)},le=()=>{P(),b.value=!1,x.value=!1,T.value=null,s.value=a.initialAngle,i.value={startAngle:a.initialAngle,endAngle:a.initialAngle,duration:a.spinDuration,startTime:0},I(),f(),y.value=v(s.value)},oe=()=>{a.spinOnClick&&q()};return n.watch(()=>a.size,()=>{n.nextTick(f)}),n.watch(()=>a.centerHoleRatio,()=>{n.nextTick(f)}),n.watch(()=>a.borderWidth,()=>{n.nextTick(f)}),n.watch(()=>a.borderColor,()=>{n.nextTick(f)}),n.watch(()=>a.pointerPosition,()=>{y.value=v(s.value)}),n.watch(()=>a.initialAngle,t=>{b.value||(s.value=t,i.value.startAngle=t,i.value.endAngle=t,i.value.startTime=0,f())}),n.watch(()=>a.spinDuration,t=>{i.value.duration=t}),n.watch(u,()=>{n.nextTick(()=>{y.value=v(s.value),f()})}),n.onMounted(()=>{f(),y.value=v(s.value)}),n.onBeforeUnmount(()=>{P(),k.value&&k.value.close()}),J({spin:q,stop:ae,reset:le,getCurrentItem:B}),(t,e)=>(n.openBlock(),n.createElementBlock("div",{class:"casino-roulette",style:n.normalizeStyle({width:h.size+"px",height:h.size+"px"})},[n.createElementVNode("canvas",{ref_key:"canvasRef",ref:V,class:n.normalizeClass(["roulette-canvas",{clickable:h.spinOnClick}]),width:h.size,height:h.size,"aria-label":`Roulette avec ${u.value.length} sections`,onClick:oe},null,10,E),L.value?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass(["roulette-pointer",`pointer-${a.pointerPosition}`]),style:n.normalizeStyle(Q.value)},[...e[0]||(e[0]=[n.createElementVNode("div",{class:"pointer-shape"},null,-1)])],6)):n.createCommentVNode("",!0)],4))}});m.VueRoulette=R,m.default=R,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
