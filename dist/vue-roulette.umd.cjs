(function(g,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(g=typeof globalThis<"u"?globalThis:g||self,n(g.VueRoulette={},g.Vue))})(this,(function(g,n){"use strict";const G=["width","height","aria-label"],N="#27ae60",U="#c0392b",J="#2c3e50",B=((d,S)=>{const T=d.__vccOpts||d;for(const[A,a]of S)T[A]=a;return T})(n.defineComponent({__name:"VueRoulette",props:{items:{type:Array,required:!0},size:{type:Number,default:400},spinDuration:{type:Number,default:4e3},easingFunction:{type:Function,default:d=>1-Math.pow(1-d,4)},useColor:{type:Boolean,default:!1},initialVelocity:{type:Number,default:2e3},initialAngle:{type:Number,default:0},enableTickSound:{type:Boolean,default:!1},pointerOptions:{type:Object,default:()=>({})},pointerPosition:{type:String,default:"top"},centerHoleRatio:{type:Number,default:.28},spinOnClick:{type:Boolean,default:!1},tickSoundVolume:{type:Number,default:.15},borderWidth:{type:Number,default:4},borderColor:{type:String,default:"#ffffff"}},emits:["spin-start","spin-end","select","update:angle"],setup(d,{expose:S,emit:T}){const A=["#f39c12","#8e44ad","#16a085","#d35400"],a=d,P=T,F=n.ref(null),s=n.ref(a.initialAngle),b=n.ref(!1),x=n.ref(null),i=n.ref({startAngle:a.initialAngle,endAngle:a.initialAngle,duration:a.spinDuration,startTime:0}),I=n.ref(null),y=n.ref(null),k=n.ref(null),C=n.ref(!1),W=n.computed(()=>({visible:!0,color:"#ffffff",width:26,length:38,...a.pointerOptions??{}})),K=n.computed(()=>W.value.visible!==!1),L=n.computed(()=>{const{width:t,length:e,color:o}=W.value,l={"--pointer-width":`${t}px`,"--pointer-length":`${e}px`,"--pointer-color":o??"#ffffff"},r=`${-(e/2)}px`;switch(a.pointerPosition){case"bottom":return{...l,bottom:r,left:"50%",transform:"translate(-50%, 0)"};case"left":return{...l,left:r,top:"50%",transform:"translate(0, -50%)"};case"right":return{...l,right:r,top:"50%",transform:"translate(0, -50%)"};case"top":default:return{...l,top:r,left:"50%",transform:"translate(-50%, 0)"}}}),c=n.computed(()=>{const t=!a.useColor&&a.items.length%2===1;return(t?[{label:"0",value:"0",color:N},...a.items]:[...a.items]).map((o,l)=>{if(a.useColor){const u=A.length?l%A.length:0,h=A[u]??"#ffffff",f=o.color??h;return{label:o.label,value:o.value,color:f}}if(t&&l===0)return{label:o.label,value:o.value,color:N};const m=(t?l-1:l)%2===0?U:J;return{label:o.label,value:o.value,color:m}})}),_=n.computed(()=>c.value.length?360/c.value.length:0),z=t=>{const e=t%360;return e>=0?e:e+360},Q=()=>{switch(a.pointerPosition){case"right":return-90;case"bottom":return 180;case"left":return 90;case"top":default:return 0}},v=t=>{if(!c.value.length)return null;const e=Q(),o=t+e,l=z(o),r=_.value,m=r/2,h=(360-(l-m+360)%360)%360;let f=Math.floor(h/r);return f>=c.value.length&&(f=c.value.length-1),f},D=()=>{const t=v(s.value);return t===null?null:c.value[t]??null},X=()=>{if(!a.enableTickSound||typeof window>"u")return;k.value||(k.value=new AudioContext);const t=k.value;if(!t)return;t.state==="suspended"&&t.resume();const e=t.createOscillator(),o=t.createGain(),l=Math.max(0,Math.min(1,a.tickSoundVolume));e.frequency.value=1200,o.gain.value=l,e.connect(o),o.connect(t.destination);const r=t.currentTime;o.gain.setValueAtTime(l,r),o.gain.exponentialRampToValueAtTime(1e-4,r+.02),e.start(r),e.stop(r+.02)},Y=()=>{const t=v(s.value);t!==null&&y.value!==t&&(y.value=t,X())},O=()=>{P("update:angle",z(s.value))},Z=t=>{let e=t.replace("#","");e.length===3&&(e=e.split("").map(u=>u+u).join(""));const o=parseInt(e.substring(0,2),16),l=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return(.299*o+.587*l+.114*r)/255>.5?"#000000":"#ffffff"},p=()=>{const t=F.value;if(!t)return;const e=t.getContext("2d");if(!e)return;const o=a.size,l=o/2,r=l*a.centerHoleRatio;e.clearRect(0,0,o,o),e.save(),e.translate(l,l);const m=c.value.length,u=a.borderWidth??4;if(!m){const M=l-u/2;e.beginPath(),e.arc(0,0,M,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=u,e.stroke(),e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(0,0,r,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.arc(0,0,r,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=u,e.stroke(),e.restore();return}const h=2*Math.PI/m,f=s.value*Math.PI/180,re=-Math.PI/2-h/2,R=l-u/2;c.value.forEach((M,ie)=>{const V=f+ie*h+re,H=V+h;e.beginPath(),e.moveTo(0,0),e.fillStyle=M.color,e.arc(0,0,R,V,H),e.closePath(),e.fill(),e.save(),e.fillStyle=Z(M.color),e.rotate((V+H)/2),e.textAlign="right",e.font=`${Math.max(14,l*.08)}px sans-serif`,e.fillText(M.label,R-20,6),e.restore()}),u>0&&(e.beginPath(),e.arc(0,0,R,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=u,e.stroke()),e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(0,0,r,0,Math.PI*2),e.fill(),e.restore(),u>0&&(e.beginPath(),e.arc(0,0,r,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=u,e.stroke()),e.restore()},w=()=>{x.value!==null&&(cancelAnimationFrame(x.value),x.value=null)},ee=()=>{w(),x.value=requestAnimationFrame(j)},j=t=>{i.value.startTime||(i.value.startTime=t);const e=t-i.value.startTime,o=i.value.duration||1,l=Math.min(e/o,1),r=a.easingFunction(l);s.value=i.value.startAngle+(i.value.endAngle-i.value.startAngle)*r,O(),Y(),p(),l<1?x.value=requestAnimationFrame(j):te()},te=()=>{w(),b.value=!1,C.value=!1,O(),p(),P("spin-end");const t=D();I.value=t,t&&P("select",t)},ne=()=>{const t=Math.floor(a.initialVelocity*a.spinDuration/36e4);return Math.max(3,t)+Math.floor(Math.random()*3)},q=()=>{if(c.value.length<=1)return .5;const t=.04;return t+Math.random()*(1-t*2)},$=(t,e,o=.5)=>{if(!c.value.length)return s.value;const l=_.value,r=z(s.value),m=Math.min(Math.max(o,.01),.99),u=l/2;let f=(360-(t+m)*l+u)%360-r;return f<=0&&(f+=360),f+=e*360,s.value+f},E=()=>{if(!c.value.length||b.value)return;C.value=!1;const t=Math.floor(Math.random()*c.value.length),e=c.value[t];e&&(I.value=e,i.value.startAngle=s.value,i.value.endAngle=$(t,ne(),q()),i.value.duration=a.spinDuration,i.value.startTime=0,b.value=!0,P("spin-start"),ee())},ae=()=>{if(!b.value||C.value)return;C.value=!0;const t=v(s.value);if(t===null)return;const e=c.value[t];e&&(I.value=e,i.value.startAngle=s.value,i.value.endAngle=$(t,1,q()),i.value.duration=Math.min(a.spinDuration/2,1e3),i.value.startTime=0)},le=()=>{w(),b.value=!1,C.value=!1,I.value=null,s.value=a.initialAngle,i.value={startAngle:a.initialAngle,endAngle:a.initialAngle,duration:a.spinDuration,startTime:0},O(),p(),y.value=v(s.value)},oe=()=>{a.spinOnClick&&E()};return n.watch(()=>a.size,()=>{n.nextTick(p)}),n.watch(()=>a.centerHoleRatio,()=>{n.nextTick(p)}),n.watch(()=>a.borderWidth,()=>{n.nextTick(p)}),n.watch(()=>a.borderColor,()=>{n.nextTick(p)}),n.watch(()=>a.pointerPosition,()=>{y.value=v(s.value)}),n.watch(()=>a.initialAngle,t=>{b.value||(s.value=t,i.value.startAngle=t,i.value.endAngle=t,i.value.startTime=0,p())}),n.watch(()=>a.spinDuration,t=>{i.value.duration=t}),n.watch(c,()=>{n.nextTick(()=>{y.value=v(s.value),p()})}),n.onMounted(()=>{p(),y.value=v(s.value)}),n.onBeforeUnmount(()=>{w(),k.value&&k.value.close()}),S({spin:E,stop:ae,reset:le,getCurrentItem:D}),(t,e)=>(n.openBlock(),n.createElementBlock("div",{class:"casino-roulette",style:n.normalizeStyle({width:d.size+"px",height:d.size+"px"})},[n.createElementVNode("canvas",{ref_key:"canvasRef",ref:F,class:n.normalizeClass(["roulette-canvas",{clickable:d.spinOnClick}]),width:d.size,height:d.size,"aria-label":`Roulette avec ${c.value.length} sections`,onClick:oe},null,10,G),K.value?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass(["roulette-pointer",`pointer-${a.pointerPosition}`]),style:n.normalizeStyle(L.value)},[...e[0]||(e[0]=[n.createElementVNode("div",{class:"pointer-shape"},null,-1)])],6)):n.createCommentVNode("",!0)],4))}}),[["__scopeId","data-v-8ca3b7dc"]]);g.VueRoulette=B,g.default=B,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
