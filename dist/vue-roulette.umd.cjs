(function(d,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(d=typeof globalThis<"u"?globalThis:d||self,n(d.VueRoulette={},d.Vue))})(this,(function(d,n){"use strict";const W=["width","height","aria-label"],V="#27ae60",G="#c0392b",H="#2c3e50",O=((f,S)=>{const T=f.__vccOpts||f;for(const[b,l]of S)T[b]=l;return T})(n.defineComponent({__name:"VueRoulette",props:{items:{type:Array,required:!0},size:{type:Number,default:400},spinDuration:{type:Number,default:4e3},easingFunction:{type:Function,default:f=>1-Math.pow(1-f,4)},useColor:{type:Boolean,default:!1},initialVelocity:{type:Number,default:2e3},initialAngle:{type:Number,default:0},enableTickSound:{type:Boolean,default:!1},pointerOptions:{type:Object,default:()=>({})},pointerPosition:{type:String,default:"top"}},emits:["spin-start","spin-end","select","update:angle"],setup(f,{expose:S,emit:T}){const b=["#f39c12","#8e44ad","#16a085","#d35400"],l=f,k=T,_=n.ref(null),i=n.ref(l.initialAngle),v=n.ref(!1),A=n.ref(null),r=n.ref({startAngle:l.initialAngle,endAngle:l.initialAngle,duration:l.spinDuration,startTime:0}),P=n.ref(null),x=n.ref(null),y=n.ref(null),M=n.ref(!1),N=n.computed(()=>({visible:!0,color:"#ffffff",width:26,length:38,...l.pointerOptions??{}})),U=n.computed(()=>N.value.visible!==!1),J=n.computed(()=>{const{width:t,length:e,color:o}=N.value,a={"--pointer-width":`${t}px`,"--pointer-length":`${e}px`,"--pointer-color":o??"#ffffff"},u=`${-(e/2)}px`;switch(l.pointerPosition){case"bottom":return{...a,bottom:u,left:"50%",transform:"translate(-50%, 0)"};case"left":return{...a,left:u,top:"50%",transform:"translate(0, -50%)"};case"right":return{...a,right:u,top:"50%",transform:"translate(0, -50%)"};case"top":default:return{...a,top:u,left:"50%",transform:"translate(-50%, 0)"}}}),s=n.computed(()=>{const t=!l.useColor&&l.items.length%2===1;return(t?[{label:"0",value:"0",color:V},...l.items]:[...l.items]).map((o,a)=>{if(l.useColor){const c=b.length?a%b.length:0,z=b[c]??"#ffffff",p=o.color??z;return{label:o.label,value:o.value,color:p}}if(t&&a===0)return{label:o.label,value:o.value,color:V};const m=(t?a-1:a)%2===0?G:H;return{label:o.label,value:o.value,color:m}})}),F=n.computed(()=>s.value.length?360/s.value.length:0),w=t=>{const e=t%360;return e>=0?e:e+360},h=t=>{if(!s.value.length)return null;const e=w(t),o=F.value,a=o/2,m=(360-(e-a+360)%360)%360;let c=Math.floor(m/o);return c>=s.value.length&&(c=s.value.length-1),c},B=()=>{const t=h(i.value);return t===null?null:s.value[t]??null},K=()=>{if(!l.enableTickSound||typeof window>"u")return;y.value||(y.value=new AudioContext);const t=y.value;if(!t)return;t.state==="suspended"&&t.resume();const e=t.createOscillator(),o=t.createGain();e.frequency.value=1200,o.gain.value=.0015,e.connect(o),o.connect(t.destination);const a=t.currentTime;o.gain.setValueAtTime(.0015,a),o.gain.exponentialRampToValueAtTime(1e-5,a+.02),e.start(a),e.stop(a+.02)},L=()=>{const t=h(i.value);t!==null&&x.value!==t&&(x.value=t,K())},C=()=>{k("update:angle",w(i.value))},g=()=>{const t=_.value;if(!t)return;const e=t.getContext("2d");if(!e)return;const o=l.size,a=o/2,u=a*.28;e.clearRect(0,0,o,o),e.save(),e.translate(a,a);const m=s.value.length;if(!m){e.beginPath(),e.arc(0,0,a-8,0,Math.PI*2),e.strokeStyle="#d6d6d6",e.lineWidth=4,e.stroke(),e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(0,0,u,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.arc(0,0,u,0,Math.PI*2),e.strokeStyle="rgba(255, 255, 255, 0.35)",e.lineWidth=Math.max(2,a*.012),e.stroke(),e.restore();return}const c=2*Math.PI/m,z=i.value*Math.PI/180,p=-Math.PI/2-c/2;s.value.forEach((j,ne)=>{const R=z+ne*c+p,E=R+c;e.beginPath(),e.moveTo(0,0),e.fillStyle=j.color,e.arc(0,0,a-4,R,E),e.closePath(),e.fill(),e.save(),e.fillStyle="#ffffff",e.rotate((R+E)/2),e.textAlign="right",e.font=`${Math.max(14,a*.08)}px sans-serif`,e.fillText(j.label,a-24,6),e.restore()}),e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(0,0,u,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.arc(0,0,u,0,Math.PI*2),e.strokeStyle="rgba(255, 255, 255, 0.35)",e.lineWidth=Math.max(2,a*.012),e.stroke(),e.restore()},I=()=>{A.value!==null&&(cancelAnimationFrame(A.value),A.value=null)},Q=()=>{I(),A.value=requestAnimationFrame(D)},D=t=>{r.value.startTime||(r.value.startTime=t);const e=t-r.value.startTime,o=r.value.duration||1,a=Math.min(e/o,1),u=l.easingFunction(a);i.value=r.value.startAngle+(r.value.endAngle-r.value.startAngle)*u,C(),L(),g(),a<1?A.value=requestAnimationFrame(D):X()},X=()=>{I(),v.value=!1,M.value=!1,C(),g(),k("spin-end");const t=B();P.value=t,t&&k("select",t)},Y=()=>{const t=Math.floor(l.initialVelocity*l.spinDuration/36e4);return Math.max(3,t)+Math.floor(Math.random()*3)},q=()=>{if(s.value.length<=1)return .5;const t=.04;return t+Math.random()*(1-t*2)},$=(t,e,o=.5)=>{if(!s.value.length)return i.value;const a=F.value,u=w(i.value),m=Math.min(Math.max(o,.01),.99),c=a/2;let p=(360-(t+m)*a+c)%360-u;return p<=0&&(p+=360),p+=e*360,i.value+p},Z=()=>{if(!s.value.length||v.value)return;M.value=!1;const t=Math.floor(Math.random()*s.value.length),e=s.value[t];e&&(P.value=e,r.value.startAngle=i.value,r.value.endAngle=$(t,Y(),q()),r.value.duration=l.spinDuration,r.value.startTime=0,v.value=!0,k("spin-start"),Q())},ee=()=>{if(!v.value||M.value)return;M.value=!0;const t=h(i.value);if(t===null)return;const e=s.value[t];e&&(P.value=e,r.value.startAngle=i.value,r.value.endAngle=$(t,1,q()),r.value.duration=Math.min(l.spinDuration/2,1e3),r.value.startTime=0)},te=()=>{I(),v.value=!1,M.value=!1,P.value=null,i.value=l.initialAngle,r.value={startAngle:l.initialAngle,endAngle:l.initialAngle,duration:l.spinDuration,startTime:0},C(),g(),x.value=h(i.value)};return n.watch(()=>l.size,()=>{n.nextTick(g)}),n.watch(()=>l.initialAngle,t=>{v.value||(i.value=t,r.value.startAngle=t,r.value.endAngle=t,r.value.startTime=0,g())}),n.watch(()=>l.spinDuration,t=>{r.value.duration=t}),n.watch(s,()=>{n.nextTick(()=>{x.value=h(i.value),g()})}),n.onMounted(()=>{g(),x.value=h(i.value)}),n.onBeforeUnmount(()=>{I(),y.value&&y.value.close()}),S({spin:Z,stop:ee,reset:te,getCurrentItem:B}),(t,e)=>(n.openBlock(),n.createElementBlock("div",{class:"casino-roulette",style:n.normalizeStyle({width:f.size+"px",height:f.size+"px"})},[n.createElementVNode("canvas",{ref_key:"canvasRef",ref:_,class:"roulette-canvas",width:f.size,height:f.size,"aria-label":`Roulette avec ${s.value.length} sections`},null,8,W),U.value?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass(["roulette-pointer",`pointer-${l.pointerPosition}`]),style:n.normalizeStyle(J.value)},[...e[0]||(e[0]=[n.createElementVNode("div",{class:"pointer-shape"},null,-1)])],6)):n.createCommentVNode("",!0)],4))}}),[["__scopeId","data-v-de5de1ac"]]);d.VueRoulette=O,d.default=O,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
