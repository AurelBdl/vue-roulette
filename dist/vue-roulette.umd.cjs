(function(g,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(g=typeof globalThis<"u"?globalThis:g||self,n(g.VueRoulette={},g.Vue))})(this,(function(g,n){"use strict";const H=["width","height","aria-label"],G="#27ae60",U="#c0392b",J="#2c3e50",N=((f,I)=>{const T=f.__vccOpts||f;for(const[A,a]of I)T[A]=a;return T})(n.defineComponent({__name:"VueRoulette",props:{items:{type:Array,required:!0},size:{type:Number,default:400},spinDuration:{type:Number,default:4e3},easingFunction:{type:Function,default:f=>1-Math.pow(1-f,4)},useColor:{type:Boolean,default:!1},initialVelocity:{type:Number,default:2e3},initialAngle:{type:Number,default:0},enableTickSound:{type:Boolean,default:!1},pointerOptions:{type:Object,default:()=>({})},pointerPosition:{type:String,default:"top"},centerHoleRatio:{type:Number,default:.28},spinOnClick:{type:Boolean,default:!1},tickSoundVolume:{type:Number,default:.15},borderWidth:{type:Number,default:4},borderColor:{type:String,default:"#ffffff"}},emits:["spin-start","spin-end","select","update:angle"],setup(f,{expose:I,emit:T}){const A=["#f39c12","#8e44ad","#16a085","#d35400"],a=f,P=T,F=n.ref(null),s=n.ref(a.initialAngle),b=n.ref(!1),x=n.ref(null),i=n.ref({startAngle:a.initialAngle,endAngle:a.initialAngle,duration:a.spinDuration,startTime:0}),w=n.ref(null),y=n.ref(null),k=n.ref(null),C=n.ref(!1),B=n.computed(()=>({visible:!0,color:"#ffffff",width:26,length:38,...a.pointerOptions??{}})),K=n.computed(()=>B.value.visible!==!1),L=n.computed(()=>{const{width:t,length:e,color:r}=B.value,l={"--pointer-width":`${t}px`,"--pointer-length":`${e}px`,"--pointer-color":r??"#ffffff"},o=`${-(e/2)}px`;switch(a.pointerPosition){case"bottom":return{...l,bottom:o,left:"50%",transform:"translate(-50%, 0)"};case"left":return{...l,left:o,top:"50%",transform:"translate(0, -50%)"};case"right":return{...l,right:o,top:"50%",transform:"translate(0, -50%)"};case"top":default:return{...l,top:o,left:"50%",transform:"translate(-50%, 0)"}}}),c=n.computed(()=>{const t=!a.useColor&&a.items.length%2===1;return a.items.map((e,r)=>{if(a.useColor){const m=A.length?r%A.length:0,u=A[m]??"#ffffff",h=e.color??u;return{label:e.label,value:e.value,color:h}}if(t&&r===0)return{label:e.label,value:e.value,color:G};const o=(t?r-1:r)%2===0?U:J;return{label:e.label,value:e.value,color:o}})}),W=n.computed(()=>c.value.length?360/c.value.length:0),z=t=>{const e=t%360;return e>=0?e:e+360},Q=()=>{switch(a.pointerPosition){case"right":return-90;case"bottom":return 180;case"left":return 90;case"top":default:return 0}},v=t=>{if(!c.value.length)return null;const e=Q(),r=t+e,l=z(r),o=W.value,m=o/2,h=(360-(l-m+360)%360)%360;let p=Math.floor(h/o);return p>=c.value.length&&(p=c.value.length-1),p},_=()=>{const t=v(s.value);return t===null?null:c.value[t]??null},X=()=>{if(!a.enableTickSound||typeof window>"u")return;k.value||(k.value=new AudioContext);const t=k.value;if(!t)return;t.state==="suspended"&&t.resume();const e=t.createOscillator(),r=t.createGain(),l=Math.max(0,Math.min(1,a.tickSoundVolume));e.frequency.value=1200,r.gain.value=l,e.connect(r),r.connect(t.destination);const o=t.currentTime;r.gain.setValueAtTime(l,o),r.gain.exponentialRampToValueAtTime(1e-4,o+.02),e.start(o),e.stop(o+.02)},Y=()=>{const t=v(s.value);t!==null&&y.value!==t&&(y.value=t,X())},O=()=>{P("update:angle",z(s.value))},Z=t=>{let e=t.replace("#","");e.length===3&&(e=e.split("").map(u=>u+u).join(""));const r=parseInt(e.substring(0,2),16),l=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16);return(.299*r+.587*l+.114*o)/255>.5?"#000000":"#ffffff"},d=()=>{const t=F.value;if(!t)return;const e=t.getContext("2d");if(!e)return;const r=a.size,l=r/2,o=l*a.centerHoleRatio;e.clearRect(0,0,r,r),e.save(),e.translate(l,l);const m=c.value.length,u=a.borderWidth??4;if(!m){const M=l-u/2;e.beginPath(),e.arc(0,0,M,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=u,e.stroke(),e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=u,e.stroke(),e.restore();return}const h=2*Math.PI/m,p=s.value*Math.PI/180,re=-Math.PI/2-h/2,R=l-u/2;c.value.forEach((M,ie)=>{const V=p+ie*h+re,E=V+h;e.beginPath(),e.moveTo(0,0),e.fillStyle=M.color,e.arc(0,0,R,V,E),e.closePath(),e.fill(),e.save(),e.fillStyle=Z(M.color),e.rotate((V+E)/2),e.textAlign="right",e.font=`${Math.max(14,l*.08)}px sans-serif`,e.fillText(M.label,R-20,6),e.restore()}),u>0&&(e.beginPath(),e.arc(0,0,R,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=u,e.stroke()),e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.fill(),e.restore(),u>0&&(e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.strokeStyle=a.borderColor,e.lineWidth=u,e.stroke()),e.restore()},S=()=>{x.value!==null&&(cancelAnimationFrame(x.value),x.value=null)},ee=()=>{S(),x.value=requestAnimationFrame(D)},D=t=>{i.value.startTime||(i.value.startTime=t);const e=t-i.value.startTime,r=i.value.duration||1,l=Math.min(e/r,1),o=a.easingFunction(l);s.value=i.value.startAngle+(i.value.endAngle-i.value.startAngle)*o,O(),Y(),d(),l<1?x.value=requestAnimationFrame(D):te()},te=()=>{S(),b.value=!1,C.value=!1,O(),d(),P("spin-end");const t=_();w.value=t,t&&P("select",t)},ne=()=>{const t=Math.floor(a.initialVelocity*a.spinDuration/36e4);return Math.max(3,t)+Math.floor(Math.random()*3)},j=()=>{if(c.value.length<=1)return .5;const t=.04;return t+Math.random()*(1-t*2)},q=(t,e,r=.5)=>{if(!c.value.length)return s.value;const l=W.value,o=z(s.value),m=Math.min(Math.max(r,.01),.99),u=l/2;let p=(360-(t+m)*l+u)%360-o;return p<=0&&(p+=360),p+=e*360,s.value+p},$=()=>{if(!c.value.length||b.value)return;C.value=!1;const t=Math.floor(Math.random()*c.value.length),e=c.value[t];e&&(w.value=e,i.value.startAngle=s.value,i.value.endAngle=q(t,ne(),j()),i.value.duration=a.spinDuration,i.value.startTime=0,b.value=!0,P("spin-start"),ee())},ae=()=>{if(!b.value||C.value)return;C.value=!0;const t=v(s.value);if(t===null)return;const e=c.value[t];e&&(w.value=e,i.value.startAngle=s.value,i.value.endAngle=q(t,1,j()),i.value.duration=Math.min(a.spinDuration/2,1e3),i.value.startTime=0)},le=()=>{S(),b.value=!1,C.value=!1,w.value=null,s.value=a.initialAngle,i.value={startAngle:a.initialAngle,endAngle:a.initialAngle,duration:a.spinDuration,startTime:0},O(),d(),y.value=v(s.value)},oe=()=>{a.spinOnClick&&$()};return n.watch(()=>a.size,()=>{n.nextTick(d)}),n.watch(()=>a.centerHoleRatio,()=>{n.nextTick(d)}),n.watch(()=>a.borderWidth,()=>{n.nextTick(d)}),n.watch(()=>a.borderColor,()=>{n.nextTick(d)}),n.watch(()=>a.pointerPosition,()=>{y.value=v(s.value)}),n.watch(()=>a.initialAngle,t=>{b.value||(s.value=t,i.value.startAngle=t,i.value.endAngle=t,i.value.startTime=0,d())}),n.watch(()=>a.spinDuration,t=>{i.value.duration=t}),n.watch(c,()=>{n.nextTick(()=>{y.value=v(s.value),d()})}),n.onMounted(()=>{d(),y.value=v(s.value)}),n.onBeforeUnmount(()=>{S(),k.value&&k.value.close()}),I({spin:$,stop:ae,reset:le,getCurrentItem:_}),(t,e)=>(n.openBlock(),n.createElementBlock("div",{class:"casino-roulette",style:n.normalizeStyle({width:f.size+"px",height:f.size+"px"})},[n.createElementVNode("canvas",{ref_key:"canvasRef",ref:F,class:n.normalizeClass(["roulette-canvas",{clickable:f.spinOnClick}]),width:f.size,height:f.size,"aria-label":`Roulette avec ${c.value.length} sections`,onClick:oe},null,10,H),K.value?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass(["roulette-pointer",`pointer-${a.pointerPosition}`]),style:n.normalizeStyle(L.value)},[...e[0]||(e[0]=[n.createElementVNode("div",{class:"pointer-shape"},null,-1)])],6)):n.createCommentVNode("",!0)],4))}}),[["__scopeId","data-v-fc7087a8"]]);g.VueRoulette=N,g.default=N,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
